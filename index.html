<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>星空下的綠能騎行 - 互動簡報</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* 自定義動畫 */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-slow { 0%, 100% { opacity: 0.8; transform: scale(1); } 50% { opacity: 1; transform: scale(1.05); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-float { animation: float 6s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse-slow 4s ease-in-out infinite; }
        .animate-fadeIn { animation: fadeIn 0.8s ease-out; }
        .animate-spin-slow { animation: spin-slow 10s linear infinite; }
        
        /* 隱藏捲軸 */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-900 text-white overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- 1. 共用圖示元件 ---
        const FAIcon = ({ icon, className = "", size }) => {
            return <i className={`${icon} ${className} flex items-center justify-center`} style={{ fontSize: size ? size + 'px' : undefined }}></i>;
        };
        // 圖示定義
        const Gamepad2 = (p) => <FAIcon icon="fa-solid fa-gamepad" {...p} />;
        const Zap = (p) => <FAIcon icon="fa-solid fa-bolt" {...p} />;
        const Wind = (p) => <FAIcon icon="fa-solid fa-wind" {...p} />;
        const Sparkles = (p) => <FAIcon icon="fa-solid fa-wand-magic-sparkles" {...p} />;
        const X = (p) => <FAIcon icon="fa-solid fa-xmark" {...p} />;
        const Star = (p) => <FAIcon icon="fa-solid fa-star" {...p} />;
        const Lock = (p) => <FAIcon icon="fa-solid fa-lock" {...p} />;
        const ChevronRight = (p) => <FAIcon icon="fa-solid fa-chevron-right" {...p} />;
        const ChevronLeft = (p) => <FAIcon icon="fa-solid fa-chevron-left" {...p} />;

        // --- 2. Gemini API 呼叫函式 (修復版) ---
        const callGemini = async (prompt, apiKey) => {
            if (!apiKey) return null;
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`,
                    {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        }),
                    }
                );

                if (!response.ok) throw new Error("API Error");
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini API Error:", error);
                return null;
            }
        };

        // --- 3. 資料結構 ---
        const slidesData = [
            { id: 0, title: "SDGs零碳健身房", subtitle: "以NotebookLM分析,Gemini製作", content: [], visual: "cover", script: "歡迎來到零碳健身房..." },
            { id: 1, title: "活動影音紀錄", subtitle: "現場實錄", content: ["活動主體：SDG 3 與 SDG 7 結合。", "核心願景：用汗水點亮地球。"], visual: "video_intro", script: "首先帶大家看到活動紀錄..." },
            { id: 2, title: "核心價值 I：零碳健身", subtitle: "Switch + 腳踏車", content: ["打破限制：圖書館大廳的健身房。", "複合休閒：邊騎車邊玩 Switch。"], visual: "playground", script: "我們打造了零碳健身房..." },
            { id: 3, title: "核心價值 II：能源覺察", subtitle: "汗水換來的電", content: ["震撼教育：1 度電 = 28 小時騎乘。", "行為改變：隨手關燈變成習慣。"], visual: "bulb", script: "電量具象化..." },
            { id: 4, title: "量化成果", subtitle: "發電英雄榜", content: ["參與人數：1,331 人。", "發電王：王同學 7.18 KWH。"], visual: "chart", script: "看看具體成果..." },
            { id: 5, title: "總結與展望", subtitle: "健康永續", content: ["價值：高效益、低成本。", "行動：一起動起來！"], visual: "tree", script: "最後總結..." }
        ];

        // --- 4. API Key 輸入元件 (漂亮版) ---
        const APIKeyModal = ({ onStart }) => {
            const [inputKey, setInputKey] = useState("");

            return (
                <div className="fixed inset-0 z-[100] flex items-center justify-center bg-slate-900 px-4">
                    <div className="absolute inset-0 overflow-hidden">
                        <div className="absolute top-[-10%] left-[-10%] w-96 h-96 bg-purple-500/20 rounded-full blur-3xl animate-float"></div>
                        <div className="absolute bottom-[-10%] right-[-10%] w-96 h-96 bg-blue-500/20 rounded-full blur-3xl animate-pulse-slow"></div>
                    </div>
                    
                    <div className="bg-white/10 backdrop-blur-md border border-white/20 p-8 rounded-2xl max-w-md w-full shadow-2xl relative z-10 animate-fadeIn">
                        <div className="flex justify-center mb-6">
                            <div className="p-4 bg-yellow-400 rounded-full shadow-lg shadow-yellow-400/50">
                                <Lock size={32} className="text-slate-900" />
                            </div>
                        </div>
                        <h2 className="text-2xl font-bold text-center text-white mb-2">啟動星空簡報</h2>
                        <p className="text-center text-blue-200 mb-6 text-sm">請輸入 Gemini API Key 以啟用 AI 功能</p>
                        
                        <input 
                            type="password" 
                            value={inputKey}
                            onChange={(e) => setInputKey(e.target.value)}
                            placeholder="在此貼上 API Key..."
                            className="w-full bg-slate-800/50 border border-slate-600 rounded-xl px-4 py-3 text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-yellow-400 mb-4 transition-all"
                        />
                        
                        <button 
                            onClick={() => onStart(inputKey)}
                            disabled={!inputKey}
                            className={`w-full py-3 rounded-xl font-bold text-slate-900 transition-all ${
                                inputKey ? 'bg-yellow-400 hover:bg-yellow-300 shadow-lg shadow-yellow-400/20 transform hover:-translate-y-1' : 'bg-slate-600 cursor-not-allowed'
                            }`}
                        >
                            開始演示
                        </button>
                        
                        <div className="mt-4 text-center">
                            <button onClick={() => onStart("DEMO_MODE")} className="text-xs text-slate-400 hover:text-white underline">
                                沒有 Key？進入離線演示模式
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- 5. AI 健身教練元件 ---
        const AIAssistant = ({ onClose, apiKey }) => {
            const [step, setStep] = useState('input');
            const [mood, setMood] = useState('');
            const [time, setTime] = useState('');
            const [result, setResult] = useState(null);

            const generatePlan = async () => {
                setStep('processing');
                
                // 離線模式處理
                if (apiKey === "DEMO_MODE") {
                    setTimeout(() => {
                        setResult({
                            activity: "Switch + 腳踏車 (離線版)",
                            reason: "目前是離線模式，建議您直接享受運動的樂趣，不用想太多！",
                            iconType: 'combo'
                        });
                        setStep('result');
                    }, 2000);
                    return;
                }

                const prompt = `你是一位健身教練。使用者心情：${mood}，時間：${time}。
                若時間長(long)推薦「Switch+腳踏車」，時間短(short)推薦「健身環」。
                請回傳純JSON格式：{"activity":"名稱", "reason":"50字內推薦理由", "iconType":"combo或gamepad"}`;

                const text = await callGemini(prompt, apiKey);
                
                if (text) {
                    try {
                        let jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
                        const data = JSON.parse(jsonStr);
                        setResult(data);
                        setStep('result');
                    } catch (e) {
                        setResult({ activity: "AI 解析失敗", reason: "訊號不穩，但運動還是要繼續！", iconType: "zap" });
                        setStep('result');
                    }
                } else {
                    setResult({ activity: "連線錯誤", reason: "請檢查 API Key 是否正確。", iconType: "zap" });
                    setStep('result');
                }
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-fadeIn">
                    <div className="bg-white rounded-3xl max-w-md w-full p-6 relative overflow-hidden">
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-400 hover:text-gray-800"><X size={24}/></button>
                        
                        {step === 'input' && (
                            <div className="animate-fadeIn">
                                <h3 className="text-2xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                                    <Sparkles className="text-yellow-500" /> AI 教練
                                </h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-bold text-gray-600 mb-2">心情</label>
                                        <div className="flex gap-2">
                                            {['壓力大', '活力滿滿', '無聊'].map(m => (
                                                <button key={m} onClick={() => setMood(m)} className={`flex-1 p-2 rounded-lg border ${mood===m ? 'bg-blue-100 border-blue-500' : 'hover:bg-gray-50'}`}>{m}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-bold text-gray-600 mb-2">時間</label>
                                        <div className="flex gap-2">
                                            {[{id:'short',l:'<30分'}, {id:'long',l:'>30分'}].map(t => (
                                                <button key={t.id} onClick={() => setTime(t.id)} className={`flex-1 p-2 rounded-lg border ${time===t.id ? 'bg-blue-100 border-blue-500' : 'hover:bg-gray-50'}`}>{t.l}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <button onClick={generatePlan} disabled={!mood || !time} className="w-full py-3 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-700 disabled:bg-gray-300 mt-4">開始規劃</button>
                                </div>
                            </div>
                        )}
                        
                        {step === 'processing' && (
                            <div className="py-12 text-center text-slate-600">
                                <div className="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
                                AI 正在思考中...
                            </div>
                        )}

                        {step === 'result' && result && (
                            <div className="text-center animate-fadeIn text-slate-800">
                                <div className="text-6xl mb-4 text-blue-500 flex justify-center">
                                    {result.iconType === 'combo' ? <Gamepad2 /> : <Zap />}
                                </div>
                                <h3 className="text-2xl font-bold mb-2">{result.activity}</h3>
                                <p className="bg-gray-100 p-4 rounded-xl text-gray-600 italic mb-6">"{result.reason}"</p>
                                <button onClick={onClose} className="w-full py-3 bg-gray-800 text-white rounded-xl font-bold">我知道了</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // --- 6. 星星耳語元件 ---
        const StarryWhisper = ({ slideData, onClose, apiKey }) => {
            const [poem, setPoem] = useState('星星正在連線中...');
            
            useEffect(() => {
                const getPoem = async () => {
                    if (apiKey === "DEMO_MODE") {
                        setPoem("（離線模式）星光不問趕路人，時光不負有心人。");
                        return;
                    }
                    const prompt = `請為「${slideData.title}」這頁簡報寫一句幾米風格的短語(30字內)，感性溫暖。`;
                    const text = await callGemini(prompt, apiKey);
                    if (text) setPoem(text);
                    else setPoem("雲層太厚，聽不到星星的聲音...");
                };
                getPoem();
            }, []);

            return (
                <div className="absolute inset-0 z-30 flex items-center justify-center bg-black/60 backdrop-blur-sm p-8 animate-fadeIn">
                    <div className="bg-slate-800/90 text-white p-8 rounded-3xl max-w-lg w-full relative border border-white/20 text-center">
                        <button onClick={onClose} className="absolute top-4 right-4 text-white/50 hover:text-white"><X size={24}/></button>
                        <Star size={40} className="text-yellow-400 mx-auto mb-6 animate-pulse" />
                        <h3 className="text-xl font-serif font-bold mb-4 text-yellow-200">✨ 星星的耳語</h3>
                        <p className="text-lg leading-loose font-serif italic">{poem}</p>
                    </div>
                </div>
            );
        };

        // --- 7. 主程式 ---
        function JimmyPresentation() {
            const [apiKey, setApiKey] = useState(null); // API Key 狀態
            const [currentSlide, setCurrentSlide] = useState(0);
            const [showAI, setShowAI] = useState(false);
            const [showWhisper, setShowWhisper] = useState(false);

            // 如果沒有 Key，顯示輸入視窗
            if (!apiKey) {
                return <APIKeyModal onStart={setApiKey} />;
            }

            const slide = slidesData[currentSlide];
            const nextSlide = () => currentSlide < slidesData.length - 1 && setCurrentSlide(c => c + 1);
            const prevSlide = () => currentSlide > 0 && setCurrentSlide(c => c - 1);

            return (
                <div className="relative w-full h-screen bg-slate-900 overflow-hidden flex flex-col items-center justify-center font-sans">
                    {/* 背景特效 */}
                    <div className="absolute inset-0">
                        <div className="absolute top-20 right-20 w-64 h-64 bg-blue-500/20 rounded-full blur-[100px] animate-pulse-slow"></div>
                        <div className="absolute bottom-20 left-20 w-64 h-64 bg-purple-500/20 rounded-full blur-[100px] animate-float"></div>
                    </div>

                    {/* 主要內容卡片 */}
                    <div className="relative z-10 w-full max-w-5xl p-6 md:p-12 flex flex-col md:flex-row gap-8 items-center">
                        {/* 左側文字 */}
                        <div className="flex-1 space-y-6 text-center md:text-left">
                            <div className="inline-block px-3 py-1 bg-yellow-400/10 border border-yellow-400/50 rounded-full text-yellow-400 text-sm mb-2">
                                Slide {currentSlide + 1} / {slidesData.length}
                            </div>
                            <h1 className="text-4xl md:text-6xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400 leading-tight">
                                {slide.title}
                            </h1>
                            <h2 className="text-xl md:text-2xl text-blue-200 font-light">{slide.subtitle}</h2>
                            
                            <div className="space-y-3 mt-6">
                                {slide.content.map((item, i) => (
                                    <div key={i} className="flex items-center gap-3 text-lg text-slate-300 bg-white/5 p-3 rounded-lg border border-white/5 hover:bg-white/10 transition-colors">
                                        <div className="w-2 h-2 rounded-full bg-yellow-400"></div>
                                        {item}
                                    </div>
                                ))}
                            </div>

                            {/* 控制按鈕區 */}
                            <div className="flex flex-wrap gap-4 mt-8 justify-center md:justify-start">
                                <button onClick={() => setShowAI(true)} className="px-6 py-3 bg-gradient-to-r from-pink-500 to-purple-600 rounded-xl font-bold shadow-lg hover:shadow-pink-500/25 transition-all transform hover:-translate-y-1 flex items-center gap-2">
                                    <Sparkles size={18} /> AI 健身教練
                                </button>
                                <button onClick={() => setShowWhisper(true)} className="px-6 py-3 bg-slate-700 rounded-xl font-bold hover:bg-slate-600 transition-all flex items-center gap-2 border border-slate-600">
                                    <Star size={18} className="text-yellow-400" /> 星星的耳語
                                </button>
                            </div>
                        </div>

                        {/* 右側視覺區 (簡化版) */}
                        <div className="flex-1 w-full max-w-md aspect-square bg-gradient-to-br from-slate-800 to-slate-900 rounded-3xl border border-white/10 shadow-2xl flex items-center justify-center relative overflow-hidden group">
                            <div className="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/stardust.png')] opacity-30"></div>
                            {/* 根據 visual 顯示不同圖示 */}
                            <div className="transform transition-transform duration-700 group-hover:scale-110">
                                {slide.visual === 'cover' && <Zap size={120} className="text-yellow-400 drop-shadow-[0_0_15px_rgba(250,204,21,0.5)]" />}
                                {slide.visual === 'playground' && <Gamepad2 size={120} className="text-pink-400" />}
                                {slide.visual === 'chart' && <Wind size={120} className="text-blue-400" />}
                                {!['cover', 'playground', 'chart'].includes(slide.visual) && <Star size={100} className="text-white/20" />}
                            </div>
                        </div>
                    </div>

                    {/* 底部導航 */}
                    <div className="absolute bottom-8 flex gap-4 z-20">
                        <button onClick={prevSlide} disabled={currentSlide===0} className="p-4 rounded-full bg-white/10 hover:bg-white/20 disabled:opacity-30 backdrop-blur-md transition-all">
                            <ChevronLeft size={24} />
                        </button>
                        <button onClick={nextSlide} disabled={currentSlide===slidesData.length-1} className="p-4 rounded-full bg-white/10 hover:bg-white/20 disabled:opacity-30 backdrop-blur-md transition-all">
                            <ChevronRight size={24} />
                        </button>
                    </div>

                    {/* AI 彈出視窗 */}
                    {showAI && <AIAssistant apiKey={apiKey} onClose={() => setShowAI(false)} />}
                    {showWhisper && <StarryWhisper apiKey={apiKey} slideData={slide} onClose={() => setShowWhisper(false)} />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<JimmyPresentation />);
    </script>
</body>
</html>
